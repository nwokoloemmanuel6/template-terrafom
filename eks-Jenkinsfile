 pipeline{
         agent any
         environment {
              AWS_ACCESS_KEY_ID = credentials('AWS_ACCESS_KEY_ID')
              AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY')
              AWS_DEFAULT_REGION = "us-east-1"
         }

         parameters{
            choice(name: 'ACTION', choices: ['create', 'destroy'], description: 'Select the action to perform')
         }
         stages {
              stage("Create an EKS Cluster") {
                steps {
                    dir ('eks-cluster') {
                        expression {
                        if (params.ACTION == 'create') {
                            sh "terraform init"
                            sh "terraform apply -auto-approve"
                        } else {
                            sh "terraform destroy -auto-approve"
                        }
                }
                    } 
              }
         }
   }
   }
